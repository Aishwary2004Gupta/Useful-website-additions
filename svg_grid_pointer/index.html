<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Image Grid</title>
</head>
<body>
    <svg class="stage" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
        <g class="grid"></g>
        <g class="hero">
            <rect width="100" height="100" fill="#000" opacity="0.9" />
            <image href="" />
            <g class="close">
                <rect width="5" height="5" stroke="#fff" fill="#fff" opacity=".5" rx="1" />
                <path stroke="#222" d="M1,1 L4,4 M4,1 L1,4" stroke-width="0.5" stroke-linecap="round" />
            </g>
        </g>
    </svg>

    <svg class="tip" width="100" height="25" fill="#222">
        <rect width="80" height="24" rx="7" />
        <text fill="#fff" font-size="13.5" y="15.5" text-anchor="middle" x="40"></text>
        <path d="M0,20 30,20 15,35z" />
    </svg>
    
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            font-size: 7px;
            font-family: sans-serif;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .stage {
            width: 100%;
            height: 100%;
        }

        .tip {
            position: absolute;
            overflow: visible;
            left: 0;
            top: 0;
            pointer-events: none;
            transform-origin: 0 15px;
        }

        .pt {
            cursor: pointer;
        }

        .close {
            cursor: pointer;
        }

        .close:hover rect {
            opacity: 0.8;
        }

        .hero image {
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
        }
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        // Initialize variables
        const stage = document.querySelector(".stage");
        const grid = document.querySelector(".grid");
        const close = document.querySelector(".close");
        const tip = document.querySelector(".tip");
        const tipText = tip.querySelector("text");
        let mPos = { x: 50, y: 50 };
        let currentZoomedImage = null;

        // Create grid of points
        for (let x = 1; x < 10; x++) {
            for (let y = 1; y < 10; y++) {
                makePt(x * 10, y * 10);
            }
        }

        function makePt(x, y) {
            const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
            const img = document.createElementNS("http://www.w3.org/2000/svg", "image");
            const depth = gsap.utils.random(0.8, 1);
            
            // Add to DOM
            grid.appendChild(g);
            g.appendChild(img);
            
            // Set initial properties
            gsap.set(g, {
                x: x,
                y: y,
                attr: { class: "pt" },
                svgOrigin: `${x} ${y}`,
                scale: depth
            });
            
            gsap.set(img, {
                attr: {
                    class: "img",
                    href: `https://picsum.photos/id/${(x-1)*9 + y}/400/400`,
                    width: 14,
                    height: 14,
                    x: -7,
                    y: -7,
                    preserveAspectRatio: "xMidYMid slice"
                },
                pointerEvents: "all"
            });

            // Event handlers for each image
            img.addEventListener('mouseenter', () => handleImageEnter(img, (x-1)*9 + y));
            img.addEventListener('mouseleave', handleImageLeave);
            img.addEventListener('click', () => handleImageClick(img));
        }

        // Image hover enter handler
        function handleImageEnter(img, id) {
            tipText.textContent = `Image ${id}`;
            gsap.to(tip, { 
                duration: 0.3, 
                ease: "power3.out", 
                scale: 1,
                opacity: 1 
            });
        }

        // Image hover leave handler
        function handleImageLeave() {
            gsap.to(tip, { 
                duration: 0.3, 
                ease: "power3.inOut", 
                scale: 0,
                opacity: 0 
            });
        }

        // Image click handler
        function handleImageClick(img) {
            currentZoomedImage = img;
            
            gsap.timeline()
                .to(".tip", { 
                    ease: "power3.inOut", 
                    scale: 0,
                    opacity: 0 
                }, 0)
                .to(".img", { 
                    opacity: 0.2,
                    duration: 0.5 
                }, 0)
                .set(".hero image", {
                    attr: {
                        width: 94,
                        height: 94,
                        x: 3,
                        y: 3,
                        href: img.getAttribute("href").replace("400/400", "1200/1200")
                    }
                }, 0.3)
                .to(".hero", { 
                    autoAlpha: 1,
                    duration: 0.5 
                }, 0.3);
        }

        // Close button handler
        close.addEventListener('click', (e) => {
            e.stopPropagation();
            
            gsap.timeline()
                .to(".hero", { 
                    autoAlpha: 0,
                    duration: 0.3 
                }, 0)
                .to(".img", { 
                    opacity: 1,
                    duration: 0.5 
                }, 0.3)
                .set(".hero image", { 
                    attr: { href: "" } 
                }, 0.5);
                
            currentZoomedImage = null;
        });

        // Mouse move handler for parallax effect
        window.addEventListener('mousemove', (e) => {
            const domPt = new DOMPoint(e.clientX, e.clientY);
            const svgPt = domPt.matrixTransform(stage.getScreenCTM().inverse());
            
            mPos.x = svgPt.x;
            mPos.y = svgPt.y;
            
            // Update tip position
            gsap.to(tip, { 
                x: e.clientX, 
                y: e.clientY,
                ease: "expo.out",
                duration: 0.5 
            });
            
            // Update all points with parallax effect
            document.querySelectorAll(".pt").forEach(pt => {
                updatePointParallax(pt);
            });
        });

        // Function to update point parallax effect
        function updatePointParallax(pt) {
            const img = pt.querySelector("image");
            const x = gsap.getProperty(pt, "x");
            const y = gsap.getProperty(pt, "y");
            
            // Calculate distance from mouse
            const dx = x - mPos.x;
            const dy = y - mPos.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            const scale = Math.max(0.8 - dist / 200, 0.3);
            
            // Apply parallax effect
            gsap.to(img, {
                duration: 0.7,
                ease: "power2.out",
                attr: { 
                    x: -7 - (dx * 0.1),
                    y: -7 - (dy * 0.1)
                },
                scale: scale
            });
        }

        // Initialize tip position and visibility
        gsap.set(tip, {
            scale: 0,
            opacity: 0,
            x: window.innerWidth / 2,
            y: window.innerHeight / 2
        });

        // Initialize close button position
        gsap.set(".close", { x: 92, y: 8 });
        
        // Initialize hero visibility
        gsap.set(".hero", { autoAlpha: 0 });
        
        // Add keyboard support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && gsap.getProperty(".hero", "autoAlpha") === 1) {
                close.click();
            }
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            // Re-center tip if visible
            if (gsap.getProperty(tip, "scale") > 0) {
                gsap.set(tip, {
                    x: window.innerWidth / 2,
                    y: window.innerHeight / 2
                });
            }
        });
    </script>
</body>
</html>